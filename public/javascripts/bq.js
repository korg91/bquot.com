var BQ=function(){function h(a){this.attr=a}function j(){this.attr="id"}function k(a){this.attr=a}function o(a){this.forceChildIndex=a===null?!1:a}function y(){}function p(){}function z(){}function v(){this.maxPaths=F;this.selectorHints=[new j,new h("name"),new h("class"),new k("action"),new k("href"),new o,new y,new p,new z]}function A(a,b){var b=b||[],c=a.nodeType,d=a.childNodes,f=d.length,g=[c,a.nodeName,f].join(":"),e="",i="";switch(c){case 3:e=a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;");
break;case 8:e="<\!--"+a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"--\>";break;default:e="<"+g+">",i="</>"}e&&b.push(e);for(c=0;c<f;++c)A(d[c],b);i&&b.push(i);return b}function w(a,b,c){if(a)if(a.nodeType==3){if(a.data.indexOf(b)!==-1&&c(a))return a}else for(var d=a.firstChild;d;){a=d.nextSibling;if(d=w(d,b,c))return d;d=a}return null}function x(a){a=A(a).join("");return G(a).toString(16)}function B(a,b){var c=a,d=-1;if(a.nodeType!=1)d=rangy.dom.getNodeIndex(a),a=a.parentNode;d={xpaths:(new v).generate(a),
offset:b,checksum:x(a),nodeIndex:d};if(c.nodeType==3&&(c=c.data.replace(/^\s*|\s*$/g,""),c.length>20&&(c=c.substring(0,20)),c.length>0))d.text=c;return d}function C(a,b){for(var c=null,d=0;d<b.length&&!c;++d)for(var f=0;f<a.xpaths.length&&!c;++f){var g=bq_xpathResolve(b[d],a.xpaths[f],!0);if(g.length==1)try{x(g[0])==a.checksum&&(a.nodeIndex!=-1?a.nodeIndex<g[0].childNodes.length&&(c=g[0].childNodes[a.nodeIndex]):c=g[0])}catch(e){}}if(!c&&a.text){f=null;for(d=0;d<b.length&&!c;++d)if((g=b[d])&&g.documentElement)c=
w(g.documentElement,a.text,function(b){return x(b.parentNode)==a.checksum}),!f&&!c&&(f=w(g.documentElement,a.text,function(b){return b.data.replace(/^\s*|\s*$/g,"").indexOf(a.text)===0}));c||(c=f)}return c==null?null:new rangy.dom.DomPosition(c,a.offset)}function H(a){var a=a||rangy.getSelection(),a=a.getAllRanges(),b=[];a.length==0&&(a=rangy.getSelection(),a=a.getAllRanges());for(var c=0,d=a.length;c<d;++c){var f=b,g=c,e=a[c],i=rangy.DomRange.getRangeDocument(e),h=B(e.startContainer,e.startOffset,
i),e=B(e.endContainer,e.endOffset,i);f[g]={start:h,end:e}}return b}function I(a,b){for(var c,d,f=0,g=a.length;f<g;++f){range=a[f];range.splitBoundaries();for(d=range.createNodeIterator([3]);c=d.next();){var e=c.ownerDocument.createElement("span");e.className=b;c.parentNode.insertBefore(e,c);e.appendChild(c)}}}function J(a){for(var b=[document],c=window.frames,d=0;d<c.length;d++)try{b.push(c[d].document)}catch(f){}for(var c=[],d=0,g=a.length;d<g;++d){var e;var i=a[d];if(e=C(i.start,b))if(i=C(i.end,
[e.node.ownerDocument])){var h=rangy.createRange(e.node.ownerDocument);h.setStart(e.node,e.offset);h.setEnd(i.node,i.offset);e=h}else e=null;else e=null;e!=null&&c.push(e)}return c}var K=/^[\w_\.\-]+$/,F=20,D=function(a){if(a.indexOf("'")==-1)return"'"+a+"'";if(a.indexOf('"')==-1)return'"'+a+'"';for(var b="concat(",a=a.split('"'),c=0;c<a.length;c++){var d=c>0;a[c]!=""&&(c>0&&(b+=", "),b+='"'+a[c]+'"',d=!0);c<a.length-1&&(d&&(b+=", "),b+="'\"'")}b+=")";return b},E=function(a){for(var b=0,c=a.previousSibling;c!=
null;)c.nodeType==1&&c.tagName==a.tagName&&++b,c=c.previousSibling;return b};h.prototype.filterableByIndex=!0;h.prototype.generate=function(a){a=a.getAttribute(this.attr);return a!=null&&this.isValidValue(a)?"[@"+this.attr+"="+D(a)+"]":null};h.prototype.isValidValue=function(a){return a.length>0&&a.length<50};j.prototype=new h;j.prototype.constructor=j;j.prototype.isValidValue=function(a){return!a.match(K)?!1:h.prototype.isValidValue.call(this,a)};k.prototype=new h;k.prototype.constructor=k;k.prototype.isValidValue=
function(a){return!h.prototype.isValidValue.call(this,a)?!1:a.toLowerCase().indexOf("javascript:")!=0&&a!="#"};o.prototype.generate=function(a){var b=E(a);if(!this.forceChildIndex){for(var c=0,d=a.nextSibling;d!=null;)d.nodeType==1&&d.tagName==a.tagName&&++c,d=d.nextSibling;if(b+c==0)return null}return"["+(b+1)+"]"};y.prototype.generate=function(a){if(E(a)==0)return null;for(var b=a.nextSibling;b!=null;){if(b.nodeType==1&&b.tagName==a.tagName)return null;b=b.nextSibling}return"[last()]"};p.prototype.filterableByIndex=
!0;p.prototype.generate=function(a){for(var b=a.childNodes,c=b.length,d=0;d<c;++d)if(b[d]&&b[d].nodeType!=3)return null;a=a.textContent;return a!=null&&a.replace(/^\s*|\s*$/g,"").length>0&&a.length<50?"[text()="+D(a)+"]":null};z.prototype.generate=function(a){for(var b=a.previousSibling;b!=null;){if(b.nodeType==1&&b.tagName==a.tagName)return null;b=b.previousSibling}for(b=a.nextSibling;b!=null;){if(b.nodeType==1&&b.tagName==a.tagName)return null;b=b.nextSibling}return""};v.prototype.generateAbsolute=
function(a,b){for(var c=new o(b),d="";a!=null;){if(a.nodeType==1){var f=c.generate(a);f==null&&(f="");d="/"+a.tagName.toLowerCase()+f+d}a=a.parentNode}return d};v.prototype.generate=function(a){for(var b=[this.generateAbsolute(a)],c=[""],d=a;d!=null&&c.length>0;){if(d.nodeType==1){for(var f=d,g=[],e=0;f!=null;){if(f.nodeType==1){var i=f.tagName.toLowerCase();if(i=="body")break;for(var h=0;h<this.selectorHints.length;++h){if(b.length>=this.maxPaths)break;var k=this.selectorHints[h],j=k.generate(f);
if(j!=null)for(var o=0;o<c.length;++o){if(b.length>=this.maxPaths)break;var s=c[o];if(!(e>0&&s.length==0)){var q=i+j+(e>0?"/":"")+s,l="//"+q,m=bq_xpathResolve(a.ownerDocument,l,e>0);if(m.length==1&&m[0]==a)b.push(l);else if(e==0){for(var l=!1,r=0;r<m.length;++r)if(a==m[r]){l=!0;break}if(l)if(k.filterableByIndex){for(var q=i,m=j,l=a,r=b,p=bq_xpathResolve(l.ownerDocument,"/descendant::"+q+m),t=0,u=0;u<p.length;++u){var n;a:{for(n=l;n!=null;){if(n==p[u]){n=!0;break a}n=n.parentNode}n=!1}if(n){t=u+1;
break}}t>0&&(r.push("/descendant::"+q+m+"["+t+"]"+s),t==p.snapshotLength&&r.push("/descendant::"+q+m+"[last()]"+s))}else g.push("/"+q)}}}}}f=f.parentNode;++e}c=g}d=d.parentNode}return b};var G=function(){var a=null;return function(b){for(var c=[],d=0,f=b.length,g;d<f;++d)g=b.charCodeAt(d),g<128?c.push(g):g<2048?c.push(g>>6|192,g&63|128):c.push(g>>12|224,g>>6&63|128,g&63|128);b=-1;if(!a){for(var d=[],f=0,e;f<256;++f){e=f;for(g=8;g--;)(e&1)==1?e=e>>>1^3988292384:e>>>=1;d[f]=e>>>0}a=d}d=a;f=0;for(g=
c.length;f<g;++f)e=(b^c[f])&255,b=b>>>8^d[e];return(b^-1)>>>0}}();return{save:function(){rangy.init();var a=H();if(a.length>0){var b=JSON.stringify(a);bq_jQuery(function(){bq_jQuery.getScript("http://bquot.com/api.js?url="+encodeURIComponent(document.location.href)+"&data="+encodeURIComponent(b))})}else typeof BQ_spin!=="undefined"&&BQ_spin.hide()},restore:function(a,b,c){try{rangy.init();typeof b=="string"&&(b=JSON.parse(b));var d=J(b),f="bq-span"+(new Date).getTime();I(d,f)}finally{typeof BQ_spin!==
"undefined"&&BQ_spin.hide()}bq_jQuery(function(){bq_jQuery("."+f+":first").scrollTo();var b=bq_jQuery("."+f),d=b.text(),d=bq_jQuery.trim(d).replace(/\s+/," ");d.length>100&&(d=d.substring(0,100).replace(/[\S]*$/,"..."));b.css({"background-color":"yellow",color:"#333"}).shareIt({url:a,title:d,show:c})})}}}();